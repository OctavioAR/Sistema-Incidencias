CREATE DATABASE IF NOT EXISTS bdincidencias CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE bdincidencias;

CREATE TABLE Edificio (
    idEdificio INT AUTO_INCREMENT PRIMARY KEY,
    codigo VARCHAR(10) NOT NULL UNIQUE,
    nombre VARCHAR(100) NOT NULL,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE Aula (
    idAula INT AUTO_INCREMENT PRIMARY KEY,
    codigo VARCHAR(10) NOT NULL UNIQUE,
    nombre VARCHAR(100) NOT NULL,
    idEdificio INT,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (idEdificio) REFERENCES Edificio(idEdificio) ON DELETE CASCADE
);

CREATE TABLE Departamento (
    idDepartamento INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    idEdificio INT,
    idAula INT,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (idEdificio) REFERENCES Edificio(idEdificio) ON DELETE SET NULL,
    FOREIGN KEY (idAula) REFERENCES Aula(idAula) ON DELETE SET NULL
);

CREATE TABLE TipoUsuario (
    idTipoUsuario INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL UNIQUE,
    descripcion VARCHAR(255)
);

CREATE TABLE TipoEquipo (
    idTipoEquipo INT AUTO_INCREMENT PRIMARY KEY,
    codigo CHAR(1) NOT NULL UNIQUE,
    nombre VARCHAR(50) NOT NULL,
    descripcion VARCHAR(255)
);

CREATE TABLE Usuario (
    idUsuario INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    apellidoPat VARCHAR(100) NOT NULL,
    apellidoMat VARCHAR(100),
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    idDepartamento INT,
    idTipoUsuario INT NOT NULL,
    activo TINYINT(1) DEFAULT 1,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (idDepartamento) REFERENCES Departamento(idDepartamento) ON DELETE SET NULL,
    FOREIGN KEY (idTipoUsuario) REFERENCES TipoUsuario(idTipoUsuario)
);

CREATE TABLE Equipo (
    idEquipo INT AUTO_INCREMENT PRIMARY KEY,
    codigo VARCHAR(20) NOT NULL UNIQUE,
    nombre VARCHAR(100) NOT NULL,
    marca VARCHAR(100),
    modelo VARCHAR(100),
    noSerie VARCHAR(100) UNIQUE,
    idTipoEquipo INT,
    sistemaOperativo VARCHAR(100),
    procesador VARCHAR(100),
    ram_gb INT,
    almacenamiento_gb INT,
    direccion_ip VARCHAR(15),
    direccion_mac VARCHAR(17),
    fechaCompra DATE,
    expiracionGarantia DATE,
    idDepartamento INT,
    idAula INT,
    idResponsable INT,
    estado ENUM('activo', 'mantenimiento', 'baja', 'obsoleto', 'en_stock') DEFAULT 'activo',
    fechaUltimoMantenimiento DATE NULL,
    fechaBaja DATE NULL,
    activo TINYINT(1) DEFAULT 1,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_modificacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (idTipoEquipo) REFERENCES TipoEquipo(idTipoEquipo),
    FOREIGN KEY (idDepartamento) REFERENCES Departamento(idDepartamento) ON DELETE CASCADE,
    FOREIGN KEY (idAula) REFERENCES Aula(idAula) ON DELETE SET NULL,
    FOREIGN KEY (idResponsable) REFERENCES Usuario(idUsuario) ON DELETE SET NULL
);

CREATE TABLE Software (
    idSoftware INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    version VARCHAR(50),
    fabricante VARCHAR(100),
    tipoLicencia ENUM('Libre', 'Comercial', 'Educativa', 'Prueba'),
    fechaExpiracionLicencia DATE NULL,
    requiereActivacion TINYINT(1) DEFAULT 0,
    comentarios TEXT,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE EquipoSoftware (
    idEquipoSoftware INT AUTO_INCREMENT PRIMARY KEY,
    idEquipo INT,
    idSoftware INT,
    fechaInstalacion DATE,
    licenciaKey VARCHAR(255) NULL,
    usuarioInstalacion VARCHAR(100),
    comentarios TEXT,
    FOREIGN KEY (idEquipo) REFERENCES Equipo(idEquipo) ON DELETE CASCADE,
    FOREIGN KEY (idSoftware) REFERENCES Software(idSoftware) ON DELETE CASCADE
);

CREATE TABLE ContratoMantenimiento (
    idContrato INT AUTO_INCREMENT PRIMARY KEY,
    idEquipo INT,
    proveedor VARCHAR(100),
    numeroContrato VARCHAR(100),
    contactoProveedor VARCHAR(100),
    telefonoContacto VARCHAR(20),
    emailContacto VARCHAR(100),
    fechaInicio DATE,
    fechaFin DATE,
    costo DECIMAL(10,2),
    cobertura TEXT,
    estado ENUM('Vigente', 'Vencido', 'Cancelado', 'Pendiente') DEFAULT 'Vigente',
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (idEquipo) REFERENCES Equipo(idEquipo) ON DELETE CASCADE
);

CREATE TABLE TipoRelacion (
    idTipoRelacion INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL UNIQUE,
    descripcion VARCHAR(255),
    inversa VARCHAR(50)
);

CREATE TABLE RelacionCI (
    idRelacion INT AUTO_INCREMENT PRIMARY KEY,
    idCIOrigen INT NOT NULL,
    tipoCIOrigen ENUM('equipo', 'software', 'aula', 'edificio', 'usuario', 'departamento') NOT NULL,
    idCIDestino INT NOT NULL,
    tipoCIDestino ENUM('equipo', 'software', 'aula', 'edificio', 'usuario', 'departamento') NOT NULL,
    idTipoRelacion INT,
    fechaCreacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    usuarioCreacion INT,
    comentarios TEXT,
    FOREIGN KEY (idTipoRelacion) REFERENCES TipoRelacion(idTipoRelacion),
    FOREIGN KEY (usuarioCreacion) REFERENCES Usuario(idUsuario)
);

CREATE TABLE TipoIncidencia (
    idTipoIncidencia INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL UNIQUE,
    descripcion VARCHAR(255)
);

CREATE TABLE EstadoIncidencia (
    idEstadoIncidencia INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL UNIQUE,
    descripcion VARCHAR(255)
);

CREATE TABLE Incidencia (
    idIncidencia INT AUTO_INCREMENT PRIMARY KEY,
    titulo VARCHAR(255) NOT NULL,
    descripcion TEXT NOT NULL,
    idEstadoIncidencia INT DEFAULT 1,
    idTipoIncidencia INT,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    fecha_cierre TIMESTAMP NULL,
    idUsuarioReporta INT,
    idEquipo INT,
    idTecnicoAsignado INT NULL,
    idDepartamento INT,
    prioridad ENUM('baja', 'media', 'alta', 'critica') DEFAULT 'media',
    comentarios_cierre TEXT,
    FOREIGN KEY (idEstadoIncidencia) REFERENCES EstadoIncidencia(idEstadoIncidencia),
    FOREIGN KEY (idTipoIncidencia) REFERENCES TipoIncidencia(idTipoIncidencia),
    FOREIGN KEY (idUsuarioReporta) REFERENCES Usuario(idUsuario),
    FOREIGN KEY (idEquipo) REFERENCES Equipo(idEquipo) ON DELETE SET NULL,
    FOREIGN KEY (idTecnicoAsignado) REFERENCES Usuario(idUsuario) ON DELETE SET NULL,
    FOREIGN KEY (idDepartamento) REFERENCES Departamento(idDepartamento) ON DELETE CASCADE
);

CREATE TABLE HistorialIncidencia (
    idHistorial INT AUTO_INCREMENT PRIMARY KEY,
    idIncidencia INT,
    idEstadoAnterior INT,
    idEstadoNuevo INT,
    idUsuarioCambio INT,
    fecha_cambio TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    comentario TEXT,
    FOREIGN KEY (idIncidencia) REFERENCES Incidencia(idIncidencia) ON DELETE CASCADE,
    FOREIGN KEY (idEstadoAnterior) REFERENCES EstadoIncidencia(idEstadoIncidencia),
    FOREIGN KEY (idEstadoNuevo) REFERENCES EstadoIncidencia(idEstadoIncidencia),
    FOREIGN KEY (idUsuarioCambio) REFERENCES Usuario(idUsuario)
);

-- Tabla para almacén/inventario
CREATE TABLE Almacen (
    idAlmacen INT AUTO_INCREMENT PRIMARY KEY,
    codigo VARCHAR(20) NOT NULL UNIQUE,
    nombre VARCHAR(100) NOT NULL,
    descripcion TEXT,
    categoria ENUM('hardware', 'software', 'consumibles', 'herramientas', 'repuestos') NOT NULL,
    stock_actual INT DEFAULT 0,
    stock_minimo INT DEFAULT 0,
    ubicacion VARCHAR(100),
    proveedor VARCHAR(100),
    fecha_adquisicion DATE,
    costo_unitario DECIMAL(10,2),
    estado ENUM('disponible', 'agotado', 'baja', 'mantenimiento') DEFAULT 'disponible',
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla para RFC (Request for Change)
CREATE TABLE RFC (
    idRFC INT AUTO_INCREMENT PRIMARY KEY,
    titulo VARCHAR(255) NOT NULL,
    descripcion TEXT NOT NULL,
    justificacion TEXT,
    impacto TEXT,
    idUsuarioSolicitante INT,
    idTipoCambio ENUM('emergencia', 'normal', 'estandar') DEFAULT 'normal',
    prioridad ENUM('baja', 'media', 'alta', 'critica') DEFAULT 'media',
    estado ENUM('borrador', 'pendiente_aprobacion', 'aprobado', 'rechazado', 'en_progreso', 'completado', 'cancelado') DEFAULT 'borrador',
    fecha_solicitud TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_aprobacion TIMESTAMP NULL,
    fecha_implementacion TIMESTAMP NULL,
    fecha_cierre TIMESTAMP NULL,
    idUsuarioAprobador INT NULL,
    comentarios_aprobacion TEXT,
    FOREIGN KEY (idUsuarioSolicitante) REFERENCES Usuario(idUsuario),
    FOREIGN KEY (idUsuarioAprobador) REFERENCES Usuario(idUsuario)
);

-- Tabla para items de RFC (qué se va a cambiar)
CREATE TABLE RFCItem (
    idRFCItem INT AUTO_INCREMENT PRIMARY KEY,
    idRFC INT,
    tipo_item ENUM('equipo', 'software', 'configuracion', 'proceso') NOT NULL,
    id_item INT, -- ID del equipo, software, etc.
    descripcion_cambio TEXT NOT NULL,
    estado_anterior TEXT,
    estado_nuevo TEXT,
    FOREIGN KEY (idRFC) REFERENCES RFC(idRFC) ON DELETE CASCADE
);

-- Tabla para bitácora de cambios
CREATE TABLE BitacoraCambio (
    idBitacora INT AUTO_INCREMENT PRIMARY KEY,
    idRFC INT NULL,
    tipo_cambio VARCHAR(100) NOT NULL,
    descripcion TEXT NOT NULL,
    idUsuario INT,
    fecha_cambio TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    detalles TEXT,
    ip_address VARCHAR(45),
    user_agent TEXT,
    FOREIGN KEY (idRFC) REFERENCES RFC(idRFC),
    FOREIGN KEY (idUsuario) REFERENCES Usuario(idUsuario)
);

-- Tabla para movimientos de almacén
CREATE TABLE MovimientoAlmacen (
    idMovimiento INT AUTO_INCREMENT PRIMARY KEY,
    idAlmacen INT,
    tipo_movimiento ENUM('entrada', 'salida', 'ajuste') NOT NULL,
    cantidad INT NOT NULL,
    motivo VARCHAR(255),
    idUsuario INT,
    idIncidencia INT NULL,
    idRFC INT NULL,
    fecha_movimiento TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    comentarios TEXT,
    FOREIGN KEY (idAlmacen) REFERENCES Almacen(idAlmacen),
    FOREIGN KEY (idUsuario) REFERENCES Usuario(idUsuario),
    FOREIGN KEY (idIncidencia) REFERENCES Incidencia(idIncidencia),
    FOREIGN KEY (idRFC) REFERENCES RFC(idRFC)
);

-- Tabla para especialidades de técnicos
CREATE TABLE EspecialidadTecnico (
    idEspecialidad INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL UNIQUE,
    descripcion VARCHAR(255)
);

-- Tabla para relación técnico-especialidad
CREATE TABLE TecnicoEspecialidad (
    idTecnicoEspecialidad INT AUTO_INCREMENT PRIMARY KEY,
    idUsuario INT,
    idEspecialidad INT,
    nivel_expertise ENUM('basico', 'intermedio', 'avanzado') DEFAULT 'intermedio',
    FOREIGN KEY (idUsuario) REFERENCES Usuario(idUsuario) ON DELETE CASCADE,
    FOREIGN KEY (idEspecialidad) REFERENCES EspecialidadTecnico(idEspecialidad) ON DELETE CASCADE
);

-- Insertar especialidades
INSERT IGNORE INTO EspecialidadTecnico (nombre, descripcion) VALUES 
('Hardware', 'Reparación y mantenimiento de componentes físicos'),
('Software', 'Instalación y solución de problemas de software'),
('Redes', 'Configuración y solución de problemas de red'),
('Sistemas Operativos', 'Instalación y configuración de SO'),
('Impresoras', 'Mantenimiento y reparación de impresoras'),
('Proyectores', 'Mantenimiento y configuración de proyectores');

-- Asignar especialidades a técnicos existentes (ejemplo)
INSERT IGNORE INTO TecnicoEspecialidad (idUsuario, idEspecialidad, nivel_expertise) VALUES 
(3, 1, 'avanzado'),  -- María López - Hardware avanzado
(3, 2, 'intermedio'), -- María López - Software intermedio
(4, 2, 'avanzado'),  -- Carlos García - Software avanzado
(4, 3, 'intermedio'), -- Carlos García - Redes intermedio
(4, 1, 'basico');    -- Carlos García - Hardware básico

-- Agregar campo de especialidad recomendada a tipos de incidencia
ALTER TABLE TipoIncidencia ADD COLUMN idEspecialidadRecomendada INT NULL;
ALTER TABLE TipoIncidencia ADD FOREIGN KEY (idEspecialidadRecomendada) REFERENCES EspecialidadTecnico(idEspecialidad);

-- Actualizar tipos de incidencia con especialidades recomendadas
UPDATE TipoIncidencia SET idEspecialidadRecomendada = 1 WHERE nombre = 'Falla Hardware';
UPDATE TipoIncidencia SET idEspecialidadRecomendada = 2 WHERE nombre = 'Falla Software';
UPDATE TipoIncidencia SET idEspecialidadRecomendada = 3 WHERE nombre IN ('Problemas de red', 'Solicitud de Equipo');
UPDATE TipoIncidencia SET idEspecialidadRecomendada = 4 WHERE nombre = 'Mantenimiento Correctivo';
-- ==============================================================
-- INSERCIONES DE EJEMPLO
-- ==============================================================

INSERT IGNORE INTO TipoUsuario (nombre, descripcion) VALUES 
('Administrador', 'Acceso completo al sistema'),
('Jefe de Taller', 'Gestiona incidencias y asigna técnicos'),
('Técnico', 'Resuelve incidencias asignadas'),
('Maestro', 'Reporta incidencias');

INSERT IGNORE INTO EstadoIncidencia (nombre, descripcion) VALUES 
('Enviado', 'Incidencia reportada, pendiente de revisión'),
('Revisión Jefe', 'En revisión por el jefe de taller'),
('Rechazado', 'Incidencia rechazada por el jefe'),
('Asignado', 'Incidencia asignada a un técnico'),
('En Proceso', 'Técnico trabajando en la incidencia'),
('Liberado', 'Incidencia resuelta y verificada'),
('Cerrado', 'Incidencia completamente finalizada');

INSERT IGNORE INTO TipoIncidencia (nombre, descripcion) VALUES 
('Mantenimiento Correctivo', 'Reparación de equipo dañado'),
('Mantenimiento Preventivo', 'Mantenimiento programado'),
('Falla Hardware', 'Problema con componentes físicos'),
('Falla Software', 'Problema con programas o sistema operativo'),
('Solicitud de Equipo', 'Solicitud de nuevo equipo');

INSERT IGNORE INTO TipoEquipo (codigo, nombre, descripcion) VALUES 
('C', 'Computadora', 'Equipo de cómputo de escritorio o laptop'),
('P', 'Proyector', 'Proyector de video'),
('I', 'Impresora', 'Impresora de cualquier tipo'),
('S', 'Switch', 'Equipo de networking'),
('R', 'Router', 'Router de red'),
('M', 'Monitor', 'Monitor de computadora');

INSERT IGNORE INTO TipoRelacion (nombre, descripcion, inversa) VALUES 
('conectado_a', 'Conexión física entre dispositivos', 'conectado_desde'),
('instalado_en', 'Software instalado en hardware', 'tiene_instalado'),
('ubicado_en', 'Dispositivo ubicado en un espacio físico', 'contiene'),
('pertenece_a', 'Relación de propiedad o responsabilidad', 'tiene_a_cargo'),
('depende_de', 'Dependencia funcional entre elementos', 'es_requerido_por'),
('utilizado_por', 'Recurso utilizado por una persona', 'usa');

INSERT IGNORE INTO Edificio (codigo, nombre) VALUES 
('EA', 'Edificio A - Sistemas'),
('EB', 'Edificio B - Sistemas'),
('EC', 'Edificio C - Sistemas'),
('ED', 'Edificio D - Bioquimica');

INSERT IGNORE INTO Aula (codigo, nombre, idEdificio) VALUES 
('A01', 'Aula 01', 1),
('A02', 'Aula 02', 1),
('LP', 'Laboratorio de Programación', 2),
('A03', 'Aula 03', 1),
('L02', 'Laboratorio de Química', 4),
('C01', 'Aula 01', 3),
('C04', 'Aula 04', 3),
('B01', 'Aula 01', 2);

INSERT IGNORE INTO Departamento (nombre, idEdificio, idAula) VALUES 
('Ingeniería en Sistemas', 1, 2),
('Ingeniería en Sistemas', 2, 3),
('Ingeniería Bioquímica', 4, 5);

INSERT IGNORE INTO Usuario (nombre, apellidoPat, apellidoMat, email, password, idTipoUsuario, idDepartamento) VALUES 
('Admin', 'Sistema', '', 'admin@universidad.edu', '$2a$10$r3AI6a6uQ1VqNjVqKQYfE.FVc7k6S5jJZ8QYH6dW2qL9nV1mR7XaK', 2, 3),
('Juan', 'Pérez', 'Gómez', 'juan.perez@universidad.edu', '$2a$10$r3AI6a6uQ1VqNjVqKQYfE.FVc7k6S5jJZ8QYH6dW2qL9nV1mR7XaK', 2, 3),
('María', 'López', 'Hernández', 'maria.lopez@universidad.edu', '$2a$10$r3AI6a6uQ1VqNjVqKQYfE.FVc7k6S5jJZ8QYH6dW2qL9nV1mR7XaK', 3, 1),
('Carlos', 'García', 'Martínez', 'carlos.garcia@universidad.edu', '$2a$10$r3AI6a6uQ1VqNjVqKQYfE.FVc7k6S5jJZ8QYH6dW2qL9nV1mR7XaK', 3, 1),
('Ana', 'Rodríguez', 'Sánchez', 'ana.rodriguez@universidad.edu', '$2a$10$r3AI6a6uQ1VqNjVqKQYfE.FVc7k6S5jJZ8QYH6dW2qL9nV1mR7XaK', 4, 1);

INSERT IGNORE INTO Software (nombre, version, fabricante, tipoLicencia, fechaExpiracionLicencia, requiereActivacion) VALUES 
('Windows 10', '21H2', 'Microsoft', 'Comercial', '2024-12-31', 1),
('Windows 11', '22H2', 'Microsoft', 'Comercial', '2025-06-30', 1),
('Microsoft Office', '2021', 'Microsoft', 'Comercial', '2024-10-15', 1),
('Adobe Photoshop', 'CC 2023', 'Adobe', 'Comercial', '2024-08-20', 1),
('Visual Studio Code', '1.74', 'Microsoft', 'Libre', NULL, 0),
('Python', '3.11', 'Python Software Foundation', 'Libre', NULL, 0),
('Google Chrome', '108', 'Google', 'Libre', NULL, 0);

INSERT IGNORE INTO Equipo (codigo, nombre, marca, modelo, noSerie, idTipoEquipo, sistemaOperativo, procesador, ram_gb, almacenamiento_gb, direccion_ip, direccion_mac, fechaCompra, expiracionGarantia, idDepartamento, idAula, idResponsable, estado) VALUES 
('EAA01C001', 'Computadora Profesor', 'Dell', 'OptiPlex 3090', 'DEL123456', 1, 'Windows 10', 'Intel i5-10500', 8, 256, '192.168.1.10', '00:1A:2B:3C:4D:10', '2023-01-15', '2025-01-15', 1, 1, 5, 'activo'),
('EAA01P001', 'Proyector Aula 01', 'Epson', 'EB-U05', 'EPS789012', 2, 'N/A', 'N/A', NULL, NULL, NULL, '00:1B:2C:3D:4E:20', '2023-02-20', '2025-02-20', 1, 1, 5, 'activo'),
('EALPC001', 'Laptop Laboratorio', 'HP', 'EliteBook 840', 'HP345678', 1, 'Windows 11', 'Intel i7-1165G7', 16, 512, '192.168.1.50', '00:1C:2D:3E:4F:30', '2023-03-10', '2025-03-10', 1, 3, 1, 'activo'),
('EDL02I001', 'Impresora Color', 'Canon', 'PIXMA MX492', 'CAN901234', 3, 'N/A', 'N/A', NULL, NULL, '192.168.1.100', '00:1D:2E:3F:40:50', '2023-04-05', '2025-04-05', 3, 5, 2, 'activo'),
('EALPS001', 'Switch Red', 'Cisco', 'Catalyst 2960', 'CIS567890', 4, 'IOS', 'N/A', NULL, NULL, '192.168.1.1', '00:1E:2F:40:51:60', '2023-05-12', '2025-05-12', 1, 3, 1, 'activo'),
('EALPC002', 'Computadora Estudiante', 'Lenovo', 'ThinkCentre M75q', 'LEN135790', 1, 'Windows 10', 'AMD Ryzen 5', 8, 256, '192.168.1.51', '00:1F:30:41:52:70', '2023-06-18', '2025-06-18', 1, 3, 1, 'mantenimiento');

INSERT IGNORE INTO EquipoSoftware (idEquipo, idSoftware, fechaInstalacion, licenciaKey, usuarioInstalacion) VALUES 
(1, 1, '2023-01-20', 'ABCDE-12345-FGHIJ-67890', 'Admin'),
(1, 3, '2023-01-20', 'OFFICE-2021-12345', 'Admin'),
(1, 7, '2023-01-21', NULL, 'Admin'),
(3, 2, '2023-03-15', 'W11PRO-67890-KLMNO', 'Admin'),
(3, 3, '2023-03-15', 'OFFICE-2021-67890', 'Admin'),
(3, 5, '2023-03-16', NULL, 'Admin'),
(3, 6, '2023-03-16', NULL, 'Admin'),
(6, 1, '2023-06-20', 'WIN10-54321-STUVI', 'Admin'),
(6, 7, '2023-06-20', NULL, 'Admin');

INSERT IGNORE INTO ContratoMantenimiento (idEquipo, proveedor, numeroContrato, contactoProveedor, telefonoContacto, emailContacto, fechaInicio, fechaFin, costo, cobertura, estado) VALUES 
(1, 'Dell México', 'CTO-DELL-2023-001', 'Ing. Roberto Martínez', '555-123-4567', 'roberto.martinez@dell.com', '2023-01-15', '2025-01-15', 2500.00, 'Garantía extendida: hardware y soporte técnico', 'Vigente'),
(2, 'Epson Service', 'CTO-EPSON-2023-002', 'Lic. Sofia Ramírez', '555-987-6543', 'sofia.ramirez@epson.com', '2023-02-20', '2025-02-20', 1800.00, 'Mantenimiento preventivo y correctivo', 'Vigente'),
(4, 'Canon Support', 'CTO-CANON-2023-003', 'Téc. Javier López', '555-456-7890', 'javier.lopez@canon.com', '2023-04-05', '2025-04-05', 1200.00, 'Soporte técnico y suministros', 'Vigente');

INSERT IGNORE INTO RelacionCI (idCIOrigen, tipoCIOrigen, idCIDestino, tipoCIDestino, idTipoRelacion, usuarioCreacion, comentarios) VALUES 
(2, 'equipo', 1, 'equipo', 1, 1, 'Proyector conectado a computadora del profesor'),
(1, 'equipo', 1, 'aula', 3, 1, 'Computadora ubicada en Aula 01'),
(2, 'equipo', 1, 'aula', 3, 1, 'Proyector ubicado en Aula 01'),
(3, 'equipo', 3, 'aula', 3, 1, 'Laptop ubicada en Laboratorio de Programación'),
(4, 'equipo', 5, 'aula', 3, 1, 'Impresora ubicada en Laboratorio de Química'),
(5, 'equipo', 3, 'aula', 3, 1, 'Switch ubicado en Laboratorio de Programación'),
(6, 'equipo', 3, 'aula', 3, 1, 'Computadora estudiante ubicada en Laboratorio de Programación'),
(1, 'equipo', 5, 'usuario', 4, 1, 'Computadora asignada al profesor Ana Rodríguez'),
(3, 'equipo', 1, 'usuario', 4, 1, 'Laptop asignada al administrador'),
(5, 'equipo', 3, 'departamento', 4, 1, 'Switch pertenece al departamento de Sistemas');

INSERT IGNORE INTO Incidencia (titulo, descripcion, idTipoIncidencia, idUsuarioReporta, idEquipo, idDepartamento, prioridad) VALUES 
('Proyector no enciende', 'El proyector del aula 01 no responde al encendido', 3, 5, 2, 1, 'alta'),
('Computadora lenta', 'La computadora del profesor tarda mucho en abrir programas', 4, 5, 1, 1, 'media'),
('Impresora atasca papel', 'La impresora de administración atasca papel constantemente', 1, 7, 4, 3, 'media'),
('No hay conexión a internet', 'En el laboratorio de sistemas no hay conexión a internet desde hoy', 3, 6, 5, 1, 'alta'),
('Tecla de laptop descompuesta', 'La tecla Enter de la laptop del laboratorio no funciona', 3, 5, 3, 1, 'baja');

UPDATE Incidencia SET idTecnicoAsignado = 3, idEstadoIncidencia = 4 WHERE idIncidencia = 1;
UPDATE Incidencia SET idTecnicoAsignado = 4, idEstadoIncidencia = 4 WHERE idIncidencia = 2;
UPDATE Incidencia SET idTecnicoAsignado = 3, idEstadoIncidencia = 4 WHERE idIncidencia = 4;

INSERT IGNORE INTO HistorialIncidencia (idIncidencia, idEstadoAnterior, idEstadoNuevo, idUsuarioCambio, comentario) VALUES 
(1, 1, 4, 2, 'Asignado al técnico María López'),
(2, 1, 4, 2, 'Asignado al técnico Carlos García'),
(4, 1, 4, 2, 'Asignado al técnico María López por urgencia');

-- Insertar datos de ejemplo para almacén
INSERT IGNORE INTO Almacen (codigo, nombre, descripcion, categoria, stock_actual, stock_minimo, ubicacion, proveedor, costo_unitario) VALUES 
('ALM-MEM-001', 'Memoria RAM 8GB DDR4', 'Memoria RAM para computadoras de escritorio', 'hardware', 15, 5, 'Estante A-1', 'Kingston', 45.00),
('ALM-DIS-001', 'Disco SSD 256GB', 'Disco sólido para laptops y computadoras', 'hardware', 8, 3, 'Estante A-2', 'Samsung', 65.00),
('ALM-TEC-001', 'Teclado USB', 'Teclado multimedia USB', 'hardware', 20, 10, 'Estante B-1', 'Logitech', 25.00),
('ALM-CON-001', 'Tóner Impresora HP', 'Tóner para impresoras HP LaserJet', 'consumibles', 12, 5, 'Estante C-1', 'HP', 85.00),
('ALM-SOF-001', 'Licencia Windows 10 Pro', 'Licencia original Windows 10 Professional', 'software', 5, 2, 'Caja fuerte', 'Microsoft', 150.00);

